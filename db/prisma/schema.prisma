datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model test {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(256)

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @updatedAt @db.Timestamp(6)
}

enum AgeGroup {
  Farfadet
  Louveteau
  Scout
  Pionnier
  Compagnon
}

// enum Role {
//   Admin
//   RG
//   RespMatos
//   RespCleophas
//   RespCompta
//   RespSecretaire
//   Accoco
//   Chef
//   Compa
// }
model role {
  id        Int         @id @default(autoincrement())
  name      String      @unique @db.VarChar(256)

  users user_metadataONrole[]
}

model user_metadata {
  firebase_id   String    @id @db.VarChar(256)

  keyresp_local local[]
  roles         user_metadataONrole[]
  units         user_metadataONunit[]
  events        user_metadataONevent[]
}

model unit {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(256)
  age_group  AgeGroup

  local_id   Int
  local      local     @relation(fields: [local_id], references: [id])
  chefs      user_metadataONunit[]
  events     event[]

  created_at DateTime @default(now()) @db.Timestamp(6)
}

model local {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(256)
  address    String   @db.VarChar(1024)
  postalcode String   @db.VarChar(10)
  city       String   @db.VarChar(256)

  keyresp_userid  String @db.VarChar(256)
  keyresp_user    user_metadata @relation(fields: [keyresp_userid], references: [firebase_id])
  units           unit[]
  events          event[]

  created_at DateTime @default(now()) @db.Timestamp(6)
}

model event {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(256)
  start_date DateTime @db.Timestamp(6)
  end_date   DateTime @db.Timestamp(6)
  need_help  Boolean  @default(false)

  unit_id    Int
  unit       unit      @relation(fields: [unit_id], references: [id])
  local_id   Int
  local      local     @relation(fields: [local_id], references: [id])
  chefs      user_metadataONevent[]

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @updatedAt @db.Timestamp(6)
}


model user_metadataONrole {
  user_id String
  user    user_metadata @relation(fields: [user_id], references: [firebase_id])
  role_id Int
  role    role @relation(fields: [role_id], references: [id])

  @@id([user_id, role_id])
}

model user_metadataONunit {
  chef_id String
  chef    user_metadata @relation(fields: [chef_id], references: [firebase_id])
  unit_id Int
  unit    unit @relation(fields: [unit_id], references: [id])

  @@id([chef_id, unit_id])
}

model user_metadataONevent {
  chef_id String
  chef    user_metadata @relation(fields: [chef_id], references: [firebase_id])
  event_id Int
  event   event @relation(fields: [event_id], references: [id])

  @@id([chef_id, event_id])
}
